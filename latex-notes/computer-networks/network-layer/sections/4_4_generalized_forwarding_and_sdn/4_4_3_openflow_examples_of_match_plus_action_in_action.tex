\section{4.4.3 OpenFlow Examples of Match-plus-action in Action}

\begin{verbatim}
         +-------------+
         | Controller  |
         +-------------+
             /   |   \
            /    |    \
+------+   1/    |     \3   +------+
|  h1  |----(s1)----(s3)----|  h5  |
| 10.1 |   2\ 4  |  4 /2    | 10.3 |
+------+     \   |   /     +------+
             |   |   |
+------+     | 3 | 1 |
|  h2  |----(s2)----+     +------+
| 10.1 |   3/ 4  |         |  h6  |
+------+     /   |         | 10.3 |
             |   |         +------+
+------+     |   |
|  h3  |-----+   |
| 10.2 |         |
+------+         |
                 |
+------+         |
|  h4  |---------+
| 10.2 |
+------+
\end{verbatim}

This section illustrates how combining matches and actions implements core network functionality using the sample network in Figure~4.30 (hosts $h1$ through $h6$ connected via switches $s1$, $s2$, and $s3$, under the control of a central controller).

\subsection{Example 1: Simple Forwarding (Policy-Based Routing)}

\begin{itemize}
    \item Goal: Forward packets from subnet $10.3.*.*$ (hosts $h5, h6$) to subnet $10.2.*.*$ (hosts $h3, h4$) along the policy-selected path $s3 \rightarrow s1 \rightarrow s2$.
    \item Resulting switch behavior:
          \begin{enumerate}
              \item \textbf{s3}: Match packets with IP Src $=10.3.*.*$ and IP Dst $=10.2.*.*$; action: \emph{Forward(3)}.
              \item \textbf{s1}: Match packets arriving on port 1 with IP Src $=10.3.*.*$ and IP Dst $=10.2.*.*$; action: \emph{Forward(4)}.
              \item \textbf{s2}:
                    \begin{itemize}
                        \item If IP Dst = $10.2.0.3$, action: \emph{Forward(3)} (toward $h3$).
                        \item If IP Dst = $10.2.0.4$, action: \emph{Forward(4)} (toward $h4$).
                    \end{itemize}
          \end{enumerate}
    \item Insight: Matching on both ingress port and multiple IP fields enables forwarding behavior more specific than destination-based IP routing.
\end{itemize}

\subsection{Example 2: Load Balancing (Source-Specific Forwarding)}

\begin{itemize}
    \item Goal: Load-balance traffic from subnet $10.2.*.*$ (hosts $h3, h4$) destined to $10.1.*.*$ by splitting paths:
          \begin{itemize}
              \item Traffic from $h3$ uses path $s2 \rightarrow s1$.
              \item Traffic from $h4$ uses path $s2 \rightarrow s3 \rightarrow s1$.
          \end{itemize}

    \item Resulting switch behavior at \textbf{s2}:
          \begin{enumerate}
              \item Match: Ingress Port $= 3$ (from $h3$), IP Dst $=10.1.*.*$; action: \emph{Forward(2)} (toward $s1$).
              \item Match: Ingress Port $= 4$ (from $h4$), IP Dst $=10.1.*.*$; action: \emph{Forward(1)} (toward $s3$).
          \end{enumerate}

    \item Insight: This demonstrates source-specific routing, impossible with traditional destination-only forwarding.
\end{itemize}

\subsection{Example 3: Firewalling (Policy Enforcement)}

\begin{itemize}
    \item Goal: At switch $s2$, only allow packets originating from subnet $10.3.*.*$ (hosts $h5, h6$) to reach $h3$ or $h4$.
    \item Resulting switch behavior at \textbf{s2}:
          \begin{enumerate}
              \item Match: IP Src $=10.3.*.*$, IP Dst $=10.2.0.3$; action: \emph{Forward(3)}.
              \item Match: IP Src $=10.3.*.*$, IP Dst $=10.2.0.4$; action: \emph{Forward(4)}.
              \item No other rules: default action = \emph{Drop}.
          \end{enumerate}

    \item Insight: Switch $s2$ effectively acts as a firewall, blocking all traffic from $h1, h2$ destined for $h3, h4$.
\end{itemize}

\subsection{Connection to Programmable Hardware}

\begin{itemize}
    \item OpenFlow provides a fixed match-plus-action abstraction.
    \item Next-generation systems such as \textbf{P4} allow defining new header formats and custom match-action logic, enabling protocol-independent programmability of the data plane.
\end{itemize}

\subsection{Key Terms and Definitions}

\begin{itemize}
    \item \textbf{Generalized Forwarding}: Forwarding based on matching multiple header fields across layers, not only destination IP.
    \item \textbf{Flow Table}: Data structure containing match fields, counters, and actions.
    \item \textbf{OpenFlow}: Standard API enabling centralized controller-managed flow tables.
    \item \textbf{Modify-Field}: Action modifying packet headers (e.g., VLAN, IP, port).
    \item \textbf{P4}: Language for protocol-independent programmable data-plane processing.
\end{itemize}

\subsection{Core Relationships}

\begin{itemize}
    \item SDN uses generalized forwarding to implement controller-driven network-wide behavior.
    \item Flow tables combine cross-layer match fields (port, MAC, IP, transport).
    \item Forward/Drop/Modify actions enable routing, firewalling, NAT, QoS, and load balancing in one device.
\end{itemize}

\subsection{Key Insights / Takeaways}

\begin{itemize}
    \item Generalized forwarding enables rich, policy-driven behavior far beyond traditional IP routing.
    \item SDN relies on centralized controllers to ensure coherent network-wide configurations.
    \item Matching on source fields enables source-specific paths, load balancing, and security policies.
\end{itemize}


\section{4.4 Section-Wide Summary}

\subsection*{Key Terms}

\begin{itemize}
    \item \textbf{Generalized Forwarding}: A ``match-plus-action'' paradigm where forwarding decisions are based on multiple fields across multiple protocol layers (L2, L3, L4).

    \item \textbf{Match-Plus-Action}: The core abstraction of SDN data planes. First match on header fields, then apply an action (forward, drop, modify, send to controller).

    \item \textbf{Flow Table}: The data structure inside an SDN switch holding the match-plus-action rules.

    \item \textbf{SDN (Software-Defined Networking)}: An architecture that separates the data plane (switch hardware) from the control plane (remote controller software).

    \item \textbf{OpenFlow}: The standard protocol defining the match-plus-action abstraction and how an SDN controller programs a switch.

    \item \textbf{Match Fields}: The 11+ OpenFlow header fields (MAC addresses, IP addresses, TCP/UDP ports, etc.) used for matching.

    \item \textbf{Action Types}: The operations a switch can perform (Forward, Drop, Modify-Field, Send-to-Controller).

    \item \textbf{P4}: A domain-specific language for protocol-independent definition of packet-processing logic.
\end{itemize}

\subsection*{Core Relationships}

\begin{itemize}
    \item Generalized Forwarding is the enabling data-plane mechanism for SDN.

    \item OpenFlow implements the generalized forwarding abstraction, letting the SDN controller program flow tables in switches.

    \item The \emph{match} component allows a single device to function simultaneously as a switch (L2), router (L3), firewall (L3/L4), and NAT (L3/L4).

    \item The \emph{action} component (forward, drop, rewrite) makes the device truly programmable and policy-driven.
\end{itemize}

\subsection*{Key Insights / Takeaways}

\begin{itemize}
    \item ``Match-plus-action'' is the unifying abstraction that merges routing, switching, firewalling, and NAT into one programmable device.

    \item SDN breaks the traditional monolithic router by separating the ``brain'' (control plane) from the ``brawn'' (data plane), placing the brain in a logically centralized controller.

    \item The abstraction crosses layers: By matching on L2, L3, and L4 fields, SDN can implement holistic network-wide logic that traditional layered architectures could not support.

    \item SDN makes the network programmable: network-wide behaviors (load balancing, access control, traffic engineering) are implemented via controller software that automatically installs the appropriate low-level match-plus-action rules throughout the network.
\end{itemize}
